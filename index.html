<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0071e3" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Simulador de Reestructuración - DMD</title>
  
  <!-- CHART.JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Estilos -->
  <link rel="stylesheet" href="css/styles-improved.css" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/favicon.png" />
</head>
<body>
  <div class="contenedor-simulador fade-in">
    <div class="header-simulador">
      <img src="assets/DMD-LOGO.png" alt="Logo DMD" class="logo apple-logo" />
      <h1>DMD - Simulador de Reestructuración</h1>
    </div>
    
    <div class="campo">
      <label for="nombreDeudor">Nombre del cliente:</label>
      <input type="text" id="nombreDeudor" placeholder="Ej: Juan Pérez" />
    </div>
    
    <table>
      <thead>
        <tr>
          <th>N° Contrato</th>
          <th>Tipo Producto</th>
          <th>Entidad</th>
          <th>Importe de deuda (€)</th>
          <th>% Descuento</th>
          <th>Importe con descuento (€)</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody id="tablaDeudas">
        <!-- Filas dinámicas -->
      </tbody>
    </table>

    <!-- Botones principales -->
    <div class="button-group">
      <button class="btn btn-primario" id="btnAgregarFila">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        Añadir fila
      </button>
      <button class="btn btn-primario" id="btnCalcular">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M9 7h6m-6 4h6m-6 4h6M5 3h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        </svg>
        Calcular
      </button>
      <button class="btn btn-secundario" id="btnReAnalizar">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M1 4v6h6m16 10v-6h-6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        </svg>
        Re-Analizar
      </button>
    </div>

    <div class="campo tooltip">
      <label for="numCuotas">Nº de cuotas:</label>
      <input type="number" id="numCuotas" placeholder="12" value="12" min="1" />
      <span class="tooltiptext">Número de cuotas mensuales para el pago</span>
    </div>

    <div class="resultado-final" id="resultadoFinal" style="display: none;">
      <h3>Resultado del análisis</h3>
      <p id="resultadoTotalAPagar"><strong>Total a Pagar:</strong> €0.00</p>
    </div>

    <button class="btn btn-secundario" id="btnMostrarHistorial">
      <svg class="icon" viewBox="0 0 24 24">
        <path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
      </svg>
      Mostrar Historial
    </button>
  </div>

  <div class="plan-container-outer" id="planContainerOuter" style="display: none;">
    <div class="button-group">
      <button class="btn-descargar-plan" id="btnDescargarPlan">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        </svg>
        Descargar PDF
      </button>
      <button class="btn btn-primario" id="btnContratar">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        </svg>
        Contratar Plan
      </button>
      <button class="btn btn-secundario" id="btnEditarContrato" style="display: none;">
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7m-4-7l4-4m-4 4l-8 8v4h4l8-8m0-4l4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        </svg>
        Editar Contrato
      </button>
    </div>
    
    <div id="plan-de-liquidacion">
      <img src="assets/DMD-LOGO.png" alt="Logo DMD" class="logo apple-logo" style="margin:0 auto 20px" />
      <div class="header">DMD asesores</div>

      <div class="info-container">
        <div class="info-box">
          <p><strong>Nombre:</strong> <span id="plan-nombre-deudor">--</span></p>
          <p><strong>Número de deudas:</strong> <span id="plan-num-deudas">0</span></p>
          <p><strong>Deuda total:</strong> <span id="plan-deuda-total">€0.00</span></p>
        </div>
        <div class="info-box">
          <p><strong>Caso:</strong> <span id="plan-folio">--</span></p>
          <p><strong>Fecha:</strong> <span id="plan-fecha">--</span></p>
          <p><strong>Fecha de vigencia:</strong> 3 días hábiles</p>
        </div>
      </div>

      <div class="plan-container">
        <div class="plan-left">
          <div class="chart">
            <canvas id="myChart"></canvas>
          </div>
          <div class="values">
            <p>Lo que debes: <span id="plan-lo-que-debes">€0.00</span></p>
            <p>Lo que pagarías: <span id="plan-lo-que-pagarias">€0.00</span></p>
          </div>
          <div class="ahorro">
            Te ahorrarás <span id="plan-ahorro">€0.00</span>
          </div>
        </div>
        <div class="plan-right">
          <div class="plan-card">
            <p>La cuota mensual</p>
            <h4 id="plan-cuota-mensual">€0.00</h4>
          </div>
          <div class="plan-card">
            <p>El descuento total</p>
            <h4 id="plan-descuento-total">0%</h4>
          </div>
          <div class="plan-card">
            <p>La duración</p>
            <h4 id="plan-duracion">0 meses</h4>
          </div>
        </div>
      </div>

      <div class="tabla-deudas">
        <h2>Detalle de deudas</h2>
        <table>
          <thead>
            <tr>
              <th>A quién le debes</th>
              <th>Lo que debes</th>
              <th>Lo que pagarías</th>
            </tr>
          </thead>
          <tbody id="plan-tabla-body">
          </tbody>
        </table>
      </div>

      <div class="disclaimer">
        <p>La reducción de la deuda...</p>
        <p>Se aclara expresamente que...</p>
        <p>Los datos contenidos en este documento...</p>
        <p>Comisión Administrativa Mensual: El plan incluye...</p>
        <p>Comisión de Éxito: Se aplicará una comisión de...</p>
      </div>
      <div class="footer">
        <div class="asesor-info">
          <p><strong>Asesor:</strong> <span id="plan-asesor">Mailyn Yonari Troches Padilla</span></p>
          <p><strong>Email:</strong> <span id="plan-asesor-email">mailyn.troches@dmdasesores.com</span></p>
          <p>C. de José Bardasano Baos, 9, 3-B, Chamartín, 28016 Madrid</p>
        </div>
      </div>
    </div>
  </div>

  <div class="historial-container" id="historialContainer" style="display: none;">
    <h2>Historial de Simulaciones</h2>
    <table id="tablaHistorial">
      <thead>
        <tr>
          <th>Folio</th>
          <th>Fecha</th>
          <th>Nombre</th>
          <th># Deudas</th>
          <th>Deuda Original</th>
          <th>Deuda Descontada</th>
          <th>Ahorro</th>
          <th>Total a Pagar</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="historialBody"></tbody>
    </table>
    <button class="btn btn-secundario" id="btnCerrarHistorial">
      <svg class="icon" viewBox="0 0 24 24">
        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
      Cerrar Historial
    </button>
  </div>
  
  <!-- Indicador de carga -->
  <div class="indicador-carga" id="indicadorCarga" style="display: none;">
    <div class="spinner"></div>
    <p id="mensajeCarga">Procesando...</p>
  </div>
  
  <!-- Librerías PDF -->
  <script src="libs/html2canvas.min.js"></script>
  <script src="libs/jspdf.umd.min.js"></script>
  <script src="libs/html2pdf.bundle.min.js"></script>
  
  <!-- JS principal -->
  <script src="js/main-improved.js"></script>
</body>
</html>
